# bmad-assist configuration (optimized example)
# This is an optimized reference config with recommended settings.
# Copy to your project and customize provider settings as needed.

project_name: project-name
user_name: Tester
communication_language: English
document_output_language: English
user_skill_level: expert              # expert to minimize LLM verbosity

# Per-phase timeout configuration (seconds), for larger projects increase timeouts
timeouts:
  default: 600                  # 10 m
  validate_story_synthesis: 900 # 15 m
  dev_story: 3600               # 1 h
  code_review_synthesis: 1200   # 20 m
  retrospective: 900            # 15 m

providers:
  master:
    provider: claude-subprocess
    model: opus

  multi:
    - provider: gemini
      model: gemini-3-pro-preview
    - provider: claude-subprocess
      model: opus

# Per-Phase Model Configuration
phase_models:
  # Single-LLM phases
  create_story:
    provider: claude-subprocess
    model: opus
  validate_story_synthesis:
    provider: claude-subprocess
    model: opus
  dev_story:
    provider: claude-subprocess
    model: opus
  code_review_synthesis:
    provider: claude-subprocess
    model: opus
  retrospective:
    provider: claude-subprocess
    model: opus

  # Multi-LLM phases
  validate_story:
    - provider: gemini
      model: gemini-3-pro-preview
      fallback_models:
        - gemini-3-flash-preview
        - gemini-2.5-flash
    - provider: claude-subprocess
      model: opus

  code_review:
    - provider: gemini
      model: gemini-3-pro-preview
      fallback_models:
        - gemini-3-flash-preview
        - gemini-2.5-flash
    - provider: claude-subprocess
      model: opus

# Compiler configuration
compiler:
  source_context:
    budgets:
      create_story: 20000
      validate_story: 10000
      validate_story_synthesis: 10000
      dev_story: 15000
      code_review: 15000
      code_review_synthesis: 15000
      default: 20000

    scoring:
      in_file_list: 50
      in_git_diff: 50
      is_test_file: -10
      is_config_file: -5
      change_lines_factor: 1
      change_lines_cap: 50

    extraction:
      adaptive_threshold: 0.25
      hunk_context_lines: 20
      hunk_context_scale: 0.3
      max_files: 15

  strategic_context:
    budget: 10000

    defaults:
      include: [project-context, architecture]
      main_only: true

    create_story:
      include: [project-context, architecture, ux, prd]
    validate_story:
      include: [project-context, architecture, ux, prd]
    dev_story:
      include: [project-context, architecture, ux, prd]
    code_review:
      include: [project-context, architecture, ux]

benchmarking:
  enabled: true

# Loop configuration - full TEA Enterprise integration
loop:
  epic_setup:
    - tea_framework
    - tea_ci
    - tea_test_design
  story:
    - create_story
    - validate_story
    - validate_story_synthesis
    - atdd
    - dev_story
    - code_review
    - code_review_synthesis
    - test_review
  epic_teardown:
    - trace
    - tea_nfr_assess
    - retrospective

# TEA (Test Architect Enterprise) configuration
testarch:
  enabled: false
  engagement_model: auto
  atdd_mode: auto

  playwright:
    base_url: "http://localhost:3000"
    headless: true
    timeout: 300
    screenshot: only-on-failure
    video: retain-on-failure
    server:
      command: ""                              # e.g. "npm run dev"
      startup_timeout: 30
      reuse_existing: true

  context:
    enabled: true
    budget: 10000
    max_tokens_per_artifact: 4000
    max_files_per_resolver: 10
    workflows:
      dev_story:
        include: [test-design, atdd]
      code_review:
        include: [test-design]
      code_review_synthesis:
        include: [test-review]
      retrospective:
        include: [trace]

notifications:
  enabled: true
  providers:
    - type: telegram
      bot_token: "${TELEGRAM_BOT_TOKEN}"
      chat_id: "${TELEGRAM_CHAT_ID}"
    - type: discord
      webhook_url: "${DISCORD_WEBHOOK_URL}"
  events:
    - story_started
    - story_completed
    - phase_completed
    - error_occurred
    - anomaly_detected
