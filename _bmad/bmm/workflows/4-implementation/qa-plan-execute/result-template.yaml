# E2E Test Run Results Template
# Epic: {EPIC_NUM}
# Generated by: qa-plan-execute workflow
# Timestamp: {TIMESTAMP}

meta:
  epic: "{EPIC_NUM}"
  run_id: "run-{timestamp}"
  timestamp: "{iso_timestamp}"
  duration_total_ms: "{TOTAL_DURATION_MS}"
  category_filter: "{CATEGORY_FILTER}"  # A | B | all
  test_filter: "{TEST_FILTER}"          # null or specific test ID
  workflow_version: "1.0.0"

config:
  dry_run: "{DRY_RUN}"
  verbose: "{VERBOSE}"
  timeout_seconds: "{TIMEOUT_SECONDS}"
  playwright_enabled: "{PLAYWRIGHT_ENABLED}"
  fail_fast: "{FAIL_FAST}"
  non_interactive: "{NON_INTERACTIVE}"

environment:
  os: "{OS_INFO}"
  python_version: "{PYTHON_VERSION}"
  git_branch: "{GIT_BRANCH}"
  git_commit: "{GIT_COMMIT}"
  working_directory: "{WORKING_DIR}"

summary:
  total: "{TOTAL_COUNT}"
  passed: "{PASSED_COUNT}"
  passed_with_notes: "{PASSED_STAR_COUNT}"
  failed: "{FAILED_COUNT}"
  skipped: "{SKIPPED_COUNT}"
  errors: "{ERROR_COUNT}"
  pass_rate_percent: "{PASS_RATE}"

# Test results - one entry per executed test
tests:
  # Template for Category A tests
  - id: "{TEST_ID}"
    name: "{TEST_NAME}"
    category: "A"
    status: "{STATUS}"  # PASS | PASS* | FAIL | SKIP | ERROR
    duration_ms: "{DURATION_MS}"

    execution:
      command_preview: "{COMMAND_FIRST_LINE}"
      script_lines: "{SCRIPT_LINE_COUNT}"
      expected_exit_code: "{EXPECTED_EXIT_CODE}"
      actual_exit_code: "{ACTUAL_EXIT_CODE}"
      timed_out: "{TIMED_OUT}"

    output:
      stdout_length: "{STDOUT_LENGTH}"
      stdout_snippet: |
        {STDOUT_FIRST_500_CHARS}
      stderr_length: "{STDERR_LENGTH}"
      stderr_snippet: |
        {STDERR_FIRST_500_CHARS}

    validation:
      exit_code_matched: "{EXIT_CODE_MATCHED}"
      output_pattern_matched: "{OUTPUT_PATTERN_MATCHED}"
      explicit_marker: "{EXPLICIT_MARKER}"  # PASSED | FAILED | null

    metadata:
      related_story: "{RELATED_STORY}"
      related_fr: ["{FR_REF}"]
      notes: "{NOTES}"
      bug_report: "{BUG_REPORT_FILE}"  # null if passed

  # Template for Category B tests (Playwright)
  - id: "{TEST_ID}"
    name: "{TEST_NAME}"
    category: "B"
    status: "{STATUS}"
    duration_ms: "{DURATION_MS}"

    playwright:
      spec_file: "{SPEC_FILE}"
      browser: "{BROWSER}"
      headless: "{HEADLESS}"
      screenshot: "{SCREENSHOT_PATH}"

    metadata:
      related_story: "{RELATED_STORY}"
      notes: "{NOTES}"
      bug_report: "{BUG_REPORT_FILE}"

# Artifact paths
artifacts:
  results_file: "{RESULTS_FILE_PATH}"
  summary_file: "{SUMMARY_FILE_PATH}"
  bug_reports_dir: "{BUG_REPORTS_DIR}"
  test_plan_source: "{TEST_PLAN_FILE}"
